<!DOCTYPE html>
<html>
<head>
    

    

    



    <meta charset="utf-8">
    
    
    
    
    <title>以太坊区块链私链搭建和使用web3.js与节点进行交互 | ThunderFireSwordBlog</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#3F51B5">
    
    
    <meta name="keywords" content="">
    <meta name="description" content="简介： 包括以太坊私链搭建、geth控制台使用、&amp;#119;&amp;#x65;&amp;#98;&amp;#x33;&amp;#46;&amp;#106;&amp;#115;&amp;#x40;&amp;#49;&amp;#x2e;&amp;#x32;&amp;#x2e;&amp;#x36;和&amp;#119;&amp;#x65;&amp;#x62;&amp;#51;&amp;#46;&amp;#x6a;&amp;#115;&amp;#x40;&amp;#48;&amp;#x2e;&amp;#50;&amp;#46;&amp;#x30;部署合约与合约交互 版本： 以太坊：go-ethere">
<meta property="og:type" content="article">
<meta property="og:title" content="以太坊区块链私链搭建和使用web3.js与节点进行交互">
<meta property="og:url" content="https://thunderfiresword.github.io/project/2023/06/29/blog001/index.html">
<meta property="og:site_name" content="ThunderFireSwordBlog">
<meta property="og:description" content="简介： 包括以太坊私链搭建、geth控制台使用、&amp;#119;&amp;#x65;&amp;#98;&amp;#x33;&amp;#46;&amp;#106;&amp;#115;&amp;#x40;&amp;#49;&amp;#x2e;&amp;#x32;&amp;#x2e;&amp;#x36;和&amp;#119;&amp;#x65;&amp;#x62;&amp;#51;&amp;#46;&amp;#x6a;&amp;#115;&amp;#x40;&amp;#48;&amp;#x2e;&amp;#50;&amp;#46;&amp;#x30;部署合约与合约交互 版本： 以太坊：go-ethere">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://thunderfiresword.github.io/web3Blog/gethConsole.png">
<meta property="og:image" content="https://thunderfiresword.github.io/web3Blog/image-20230626154453141.png">
<meta property="og:image" content="https://thunderfiresword.github.io/web3Blog/image-20230626154712746.png">
<meta property="og:image" content="https://thunderfiresword.github.io/web3Blog/image-20230626155426974.png">
<meta property="og:image" content="https://thunderfiresword.github.io/project/2023/06/29/blog001/%E4%BB%A5%E5%A4%AA%E5%9D%8A%E5%8C%BA%E5%9D%97%E9%93%BE%E7%A7%81%E9%93%BE%E6%90%AD%E5%BB%BA%E5%92%8C%E4%BD%BF%E7%94%A8web3-js%E4%B8%8E%E8%8A%82%E7%82%B9%E8%BF%9B%E8%A1%8C%E4%BA%A4%E4%BA%92/image-20230626160150807.png">
<meta property="og:image" content="https://thunderfiresword.github.io/web3Blog/image-20230626161259808.png">
<meta property="og:image" content="https://thunderfiresword.github.io/web3Blog/image-20230626161656209.png">
<meta property="og:image" content="https://thunderfiresword.github.io/web3Blog/image-20230626162605754.png">
<meta property="og:image" content="https://thunderfiresword.github.io/web3Blog/image-20230626162739092.png">
<meta property="og:image" content="https://thunderfiresword.github.io/web3Blog/image-20230626163013818.png">
<meta property="og:image" content="https://thunderfiresword.github.io/web3Blog/image-20230626163403424.png">
<meta property="og:image" content="https://thunderfiresword.github.io/web3Blog/image-20230627095049968.png">
<meta property="og:image" content="https://thunderfiresword.github.io/web3Blog/image-20230627155252694.png">
<meta property="og:image" content="https://thunderfiresword.github.io/web3Blog/image-20230627151942379.png">
<meta property="og:image" content="https://thunderfiresword.github.io/web3Blog/image-20230627152222302.png">
<meta property="og:image" content="https://thunderfiresword.github.io/project/2023/06/29/blog001/web3Blog/image-20230627161203131.png">
<meta property="og:image" content="https://thunderfiresword.github.io/web3Blog/image-20230628164137721.png">
<meta property="og:image" content="https://thunderfiresword.github.io/web3Blog/image-20230628164212193.png">
<meta property="article:published_time" content="2023-06-29T01:53:43.000Z">
<meta property="article:modified_time" content="2023-06-30T03:11:18.432Z">
<meta property="article:author" content="ThunderFireSword">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://thunderfiresword.github.io/web3Blog/gethConsole.png">
    
        <link rel="alternate" type="application/atom+xml" title="ThunderFireSwordBlog" href="/atom.xml">
    
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="stylesheet" href="//unpkg.com/hexo-theme-material-indigo@latest/css/style.css">
    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    

<meta name="generator" content="Hexo 4.2.1"></head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(/img/Blogbkg.jpg)">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/BlogAvatar.jpg">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">ThunderFireSword</h5>
          <a href="mailto:dl0213@hnu.edu.cn" title="dl0213@hnu.edu.cn" class="mail">dl0213@hnu.edu.cn</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                主页
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                Archives
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                Tags
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                Categories
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://github.com/yscoder" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">以太坊区块链私链搭建和使用web3.js与节点进行交互</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="输入感兴趣的关键字">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title">以太坊区块链私链搭建和使用web3.js与节点进行交互</h1>
        <h5 class="subtitle">
            
                <time datetime="2023-06-29T01:53:43.000Z" itemprop="datePublished" class="page-time">
  2023-06-29
</time>


            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap post-toc-shrink" id="post-toc">
            <h4>TOC</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#以太坊私链搭建"><span class="post-toc-text">以太坊私链搭建</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#配置创世区块"><span class="post-toc-text">配置创世区块</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#运行节点"><span class="post-toc-text">运行节点</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#初始化区块链"><span class="post-toc-text">初始化区块链</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#运行"><span class="post-toc-text">运行</span></a></li></ol></li></ol></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#geth控制台基本操作"><span class="post-toc-text">geth控制台基本操作</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#查看已有账户"><span class="post-toc-text">查看已有账户</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#新建账户"><span class="post-toc-text">新建账户</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#查看余额"><span class="post-toc-text">查看余额</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#开始和停止挖矿"><span class="post-toc-text">开始和停止挖矿</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#设置挖矿地址"><span class="post-toc-text">设置挖矿地址</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#当前区块数"><span class="post-toc-text">当前区块数</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#交易池状态"><span class="post-toc-text">交易池状态</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#解锁账户"><span class="post-toc-text">解锁账户</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#发起转账"><span class="post-toc-text">发起转账</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#根据交易哈希查看交易"><span class="post-toc-text">根据交易哈希查看交易</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#退出控制台并停止节点运行"><span class="post-toc-text">退出控制台并停止节点运行</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#在geth控制台上部署智能合约"><span class="post-toc-text">在geth控制台上部署智能合约</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#geth控制台调用智能合约"><span class="post-toc-text">geth控制台调用智能合约</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#查询方法"><span class="post-toc-text">查询方法</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#发送交易"><span class="post-toc-text">发送交易</span></a></li></ol></li></ol></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#使用web3js调用智能合约"><span class="post-toc-text">使用web3js调用智能合约</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#web3js安装"><span class="post-toc-text">web3js安装</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#链接到区块链"><span class="post-toc-text">链接到区块链</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#部署合约"><span class="post-toc-text">部署合约</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#调用合约"><span class="post-toc-text">调用合约</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#创建合约实体"><span class="post-toc-text">创建合约实体</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#查询方法-1"><span class="post-toc-text">查询方法</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#发送交易-1"><span class="post-toc-text">发送交易</span></a></li></ol></li></ol></li></ol>
        </nav>
    </aside>


<article id="post-blog001"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">以太坊区块链私链搭建和使用web3.js与节点进行交互</h1>
        <div class="post-meta">
            <time class="post-time" title="2023-06-29 09:53:43" datetime="2023-06-29T01:53:43.000Z"  itemprop="datePublished">2023-06-29</time>

            


            
<span id="busuanzi_container_page_pv" title="文章总阅读量" style='display:none'>
    <i class="icon icon-eye icon-pr"></i><span id="busuanzi_value_page_pv"></span>
</span>


        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <p>简介：</p>
<p>包括以太坊私链搭建、geth控制台使用、<a href="mailto:&#119;&#x65;&#98;&#x33;&#46;&#106;&#115;&#x40;&#49;&#x2e;&#x32;&#x2e;&#x36;">&#119;&#x65;&#98;&#x33;&#46;&#106;&#115;&#x40;&#49;&#x2e;&#x32;&#x2e;&#x36;</a>和<a href="mailto:&#119;&#x65;&#x62;&#51;&#46;&#x6a;&#115;&#x40;&#48;&#x2e;&#50;&#46;&#x30;">&#119;&#x65;&#x62;&#51;&#46;&#x6a;&#115;&#x40;&#48;&#x2e;&#50;&#46;&#x30;</a>部署合约与合约交互</p>
<p>版本：</p>
<p>以太坊：go-ethereum-1.9.25</p>
<p>操作系统：CentOS7</p>
<!-- toc -->



<h1 id="以太坊私链搭建"><a href="#以太坊私链搭建" class="headerlink" title="以太坊私链搭建"></a>以太坊私链搭建</h1><p>前置：安装go环境、Geth、下载go-ethereum</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git clone https:&#x2F;&#x2F;github.com&#x2F;ethereum&#x2F;go-ethereum</span><br><span class="line">cd go-ethereum</span><br><span class="line">make geth</span><br></pre></td></tr></table></figure>

<h2 id="配置创世区块"><a href="#配置创世区块" class="headerlink" title="配置创世区块"></a>配置创世区块</h2><p>需要创建一个目录放置创世区块的文件genesis.json和节点文件夹</p>
<p>例如我把blockchain-setting作为节点的目录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">blockchain-setting</span><br><span class="line">├── node1 &#x2F;&#x2F;节点文件夹</span><br><span class="line">└── genesis.json &#x2F;&#x2F;创世区块配置</span><br></pre></td></tr></table></figure>

<p>genesis.json内容为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;config&quot;: &#123;</span><br><span class="line">    &quot;chainId&quot;: 11,</span><br><span class="line">    &quot;homesteadBlock&quot;: 0,</span><br><span class="line">    &quot;eip150Block&quot;: 0,</span><br><span class="line">    &quot;eip150Hash&quot;: &quot;0x0000000000000000000000000000000000000000000000000000000000000000&quot;,</span><br><span class="line">    &quot;eip155Block&quot;: 0,</span><br><span class="line">    &quot;eip158Block&quot;: 0,</span><br><span class="line">    &quot;byzantiumBlock&quot;: 0,</span><br><span class="line">    &quot;constantinopleBlock&quot;: 0,</span><br><span class="line">    &quot;petersburgBlock&quot;: 0,</span><br><span class="line">    &quot;ethash&quot;: &#123;&#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;nonce&quot;: &quot;0x0&quot;,</span><br><span class="line">  &quot;timestamp&quot;: &quot;0x5d5cdc87&quot;,</span><br><span class="line">  &quot;extraData&quot;: &quot;0x0000000000000000000000000000000000000000000000000000000000000000&quot;,</span><br><span class="line">  &quot;gasLimit&quot;: &quot;0x47b760&quot;,</span><br><span class="line">  &quot;difficulty&quot;: &quot;0x80000&quot;,</span><br><span class="line">  &quot;mixHash&quot;: &quot;0x0000000000000000000000000000000000000000000000000000000000000000&quot;,</span><br><span class="line">  &quot;coinbase&quot;: &quot;0x0000000000000000000000000000000000000000&quot;,</span><br><span class="line">  &quot;alloc&quot;: &#123;</span><br><span class="line">    &quot;0000000000000000000000000000000000000000&quot;: &#123;</span><br><span class="line">      &quot;balance&quot;: &quot;0x1&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;number&quot;: &quot;0x0&quot;,</span><br><span class="line">  &quot;gasUsed&quot;: &quot;0x0&quot;,</span><br><span class="line">  &quot;parentHash&quot;: &quot;0x0000000000000000000000000000000000000000000000000000000000000000&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>需要按照最新的配置设置genesis.json，旧的配置中可能缺少配置项，在后续的调用合约时可能会引起报错</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">invalid opcode: SHR</span><br></pre></td></tr></table></figure>

<p>可能是缺少以下配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&quot;byzantiumBlock&quot;: 0,</span><br><span class="line">&quot;constantinopleBlock&quot;: 0</span><br></pre></td></tr></table></figure>

<h2 id="运行节点"><a href="#运行节点" class="headerlink" title="运行节点"></a>运行节点</h2><hr>
<h3 id="初始化区块链"><a href="#初始化区块链" class="headerlink" title="初始化区块链"></a>初始化区块链</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd blockchain-setting &#x2F;&#x2F;打开上述目录</span><br><span class="line">geth --datadir node1 init genesis.json &#x2F;&#x2F;初始化区块链 node1节点文件</span><br></pre></td></tr></table></figure>

<p>初始化成功之后node1目录下会出现keystore、geth和history</p>
<p>其中keystore目录下存放用户数据，geth&#x2F;chaindata存放区块数据</p>
<h4 id="运行"><a href="#运行" class="headerlink" title="运行"></a>运行</h4><p>在节点目录下运行节点</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">geth --datadir node1 --networkid 11 --http --http.port 8545 --port 30303  -http.api eth,web3,personal,net --http.addr 0.0.0.0 --allow-insecure-unlock  --nodiscover console 2&gt;&gt;geth.log</span><br></pre></td></tr></table></figure>

<p>参数</p>
<p><code>--datadir node1</code> <!--设置区块链数据存放的位置，node1处为刚才初始化的目录名--></p>
<p><code>--networkid 11</code>  <!--networkid为用来在网络层标识当前的区块链网络，NetworkId 不一致的两个节点无法建立连接--></p>
<!--两者并没有非常高的关联度。网上几乎所有提到搭建以太坊私链的文章，都要强调 NetworkId 需要和 genesis 文件里 ChainId 的值相同，事实上是没必要的，可能因为在某一段时间内，一些开发工具比如 MetaMask，会把 NetworkId 当作 ChainId 来用。不过现在 MetaMask 已经支持自定义 ChainId，以太坊也添加了 “eth_chainId” 这个 RPC API，相信两者误用的情况会越来越少-->

<p>[相关链接]: <a href="https://zhuanlan.zhihu.com/p/583143944" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/583143944</a>	“以太坊 ChainId 与 NetworkId”</p>
<p>  <code>--http</code>                              <!--启用 HTTP-RPC 服务器--><br>  <code>--http.addr 0.0.0.0</code>        <!--HTTP-RPC 服务器监听接口（默认：“localhost”）--><br>  <code>--http.port 8545</code>            <!--HTTP-RPC 服务器监听端口（默认：8545）--><br>  <code>--http.api eth,web3,personal,net</code>        <!--通过 HTTP-RPC 接口提供的 API--></p>
<p><code>--allow-insecure-unlock</code>         <!--当与帐户相关的 RPC 被 http 公开时，允许不安全的帐户解锁，比如使用web3.js解锁账户--></p>
<p><code>--nodiscover</code>      <!--其他人无法发现你的节点,不使用该配置日志会一直输出Looking for peers--></p>
<p><code>console 2&gt;&gt;geth.log</code>       <!--日志输出重定向到geth.log--></p>
<p>[更多geth命令参数]: <a href="https://www.cnblogs.com/kaifayuan/p/14970409.html" target="_blank" rel="noopener">https://www.cnblogs.com/kaifayuan/p/14970409.html</a>	“geth命令参数详解 1.10.4”</p>
<p>启动成功之后进入geth控制台</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="\web3Blog\gethConsole.png" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<p>可以再打开一个窗口在区块链目录下用以下命令查看日志</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tail -f geth.log</span><br></pre></td></tr></table></figure>

<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="\web3Blog\image-20230626154453141.png" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>



<h1 id="geth控制台基本操作"><a href="#geth控制台基本操作" class="headerlink" title="geth控制台基本操作"></a>geth控制台基本操作</h1><hr>
<h3 id="查看已有账户"><a href="#查看已有账户" class="headerlink" title="查看已有账户"></a>查看已有账户</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">eth.accounts</span><br></pre></td></tr></table></figure>

<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="\web3Blog\image-20230626154712746.png" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>



<h3 id="新建账户"><a href="#新建账户" class="headerlink" title="新建账户"></a>新建账户</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">personal.newAccount(&quot;111&quot;) &#x2F;&#x2F;参数为密码</span><br></pre></td></tr></table></figure>

<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="\web3Blog\image-20230626155426974.png" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>



<h3 id="查看余额"><a href="#查看余额" class="headerlink" title="查看余额"></a>查看余额</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">eth.getBalance(eth.accounts[0]) &#x2F;&#x2F;参数为账户地址，这里查询第一个被创建的账户</span><br></pre></td></tr></table></figure>

<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="以太坊区块链私链搭建和使用web3-js与节点进行交互\image-20230626160150807.png" alt="image-20230626160150807" title="">
                </div>
                <div class="image-caption">image-20230626160150807</div>
            </figure>



<h3 id="开始和停止挖矿"><a href="#开始和停止挖矿" class="headerlink" title="开始和停止挖矿"></a>开始和停止挖矿</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">miner.start() &#x2F;&#x2F;开始挖矿，没有设置挖矿地址默认为第一个创建的账户</span><br><span class="line">miner.stop() &#x2F;&#x2F;停止挖矿</span><br></pre></td></tr></table></figure>

<p>开始挖矿之后日志输出</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="\web3Blog\image-20230626161259808.png" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>



<h3 id="设置挖矿地址"><a href="#设置挖矿地址" class="headerlink" title="设置挖矿地址"></a>设置挖矿地址</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">miner.setEtherbase(eth.accounts[1]) &#x2F;&#x2F;参数为账户地址，这里设置第二个创建的账户挖矿</span><br></pre></td></tr></table></figure>

<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="\web3Blog\image-20230626161656209.png" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<p>设置该账户为挖矿地址之后进行挖矿，一段时间之后余额增加</p>
<h3 id="当前区块数"><a href="#当前区块数" class="headerlink" title="当前区块数"></a>当前区块数</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">eth.blockNumber</span><br></pre></td></tr></table></figure>



<h3 id="交易池状态"><a href="#交易池状态" class="headerlink" title="交易池状态"></a>交易池状态</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">txpool.status</span><br></pre></td></tr></table></figure>



<h3 id="解锁账户"><a href="#解锁账户" class="headerlink" title="解锁账户"></a>解锁账户</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">personal.unlockAccount(eth.accounts[0])</span><br></pre></td></tr></table></figure>

<p>之后输入密码即可解锁</p>
<h3 id="发起转账"><a href="#发起转账" class="headerlink" title="发起转账"></a>发起转账</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">eth.sendTransaction(&#123;from:eth.accounts[0],to:eth.accounts[2],value:100000&#125;)</span><br></pre></td></tr></table></figure>

<p>交易之前需要解锁账户</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="\web3Blog\image-20230626162605754.png" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<p>发起转账交易之后日志中会出现提交交易的提示，因为没有在挖矿，交易未被处理，在交易池中处于挂起状态</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="\web3Blog\image-20230626162739092.png" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<p>开始挖矿，一段时间后交易处理完成，可以看到转账成功</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="\web3Blog\image-20230626163013818.png" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>



<h3 id="根据交易哈希查看交易"><a href="#根据交易哈希查看交易" class="headerlink" title="根据交易哈希查看交易"></a>根据交易哈希查看交易</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">eth.getTransaction(&quot;0x14b6dfa57dd466ea8a2a4e9a7815c5b8afd4230361f7fb5e05483041c45a6edf&quot;)</span><br></pre></td></tr></table></figure>

<p>在发送交易时会返回交易哈希值，或者在日志中提交交易一栏的fullhash字段可以找到该交易的交易哈希</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="\web3Blog\image-20230626163403424.png" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>



<h3 id="退出控制台并停止节点运行"><a href="#退出控制台并停止节点运行" class="headerlink" title="退出控制台并停止节点运行"></a>退出控制台并停止节点运行</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">exit</span><br></pre></td></tr></table></figure>

<p>日志中：INFO [06-26|16:35:29.626] Blockchain stopped</p>
<h2 id="在geth控制台上部署智能合约"><a href="#在geth控制台上部署智能合约" class="headerlink" title="在geth控制台上部署智能合约"></a>在geth控制台上部署智能合约</h2><hr>
<p>示例智能合约：实现了一个简单的将作品信息上传和查询的功能</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; SPDX-License-Identifier: MIT</span><br><span class="line">pragma solidity &gt;&#x3D;0.8.0;</span><br><span class="line"></span><br><span class="line">contract SimpCopyright&#123;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * @dev 事件日志，在版权转移时触发记录</span><br><span class="line">     *&#x2F;</span><br><span class="line">    event Transfer(address indexed from, address indexed to, string indexed workId);</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">    * work结构体：</span><br><span class="line">    * owner 上链者账户</span><br><span class="line">    * ownerWebId 上链者在网站的账号</span><br><span class="line">    * workUri ipfs上地址</span><br><span class="line">    * workOwnername 上链者真实姓名</span><br><span class="line">    * workOwnerid 上链者证件号码</span><br><span class="line">    *&#x2F;</span><br><span class="line">    struct Work&#123;</span><br><span class="line">        address owner;</span><br><span class="line">        string ownerWebId;</span><br><span class="line">        string workUri;</span><br><span class="line">        string workOwnername;</span><br><span class="line">        string workOwnerid;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">     &#x2F;&#x2F;该版权合约的创始者</span><br><span class="line">    address private _owner;</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; 版权token名称</span><br><span class="line">    string private _name;</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; 版权token标志</span><br><span class="line">    string private _symbol;</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; 版权作品id到版权拥有者地址的映射，用于存储某个id作品的拥有者,版权作品id用版权文件hash作为唯一标识</span><br><span class="line">    mapping(string &#x3D;&gt; address) private _owners;</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; 版权作品id到版权信息的映射，用于存储某个作品的详细信息，是一个结构体</span><br><span class="line">    mapping(string &#x3D;&gt; Work) private _works;</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F;构造方法</span><br><span class="line">    constructor(string memory name_, string memory symbol_)&#123;</span><br><span class="line">        _name &#x3D; name_;</span><br><span class="line">        _symbol &#x3D; symbol_;</span><br><span class="line">        _owner &#x3D; msg.sender;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    function getName() public view  returns (string memory)</span><br><span class="line">    &#123;</span><br><span class="line">        return _name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    function getSymbol() public view  returns (string memory)</span><br><span class="line">    &#123;</span><br><span class="line">        return _symbol;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function getOwner() public view  returns (address )</span><br><span class="line">    &#123;</span><br><span class="line">        return _owner;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * @dev 查询某个作品id的区块链账户</span><br><span class="line">     *&#x2F;</span><br><span class="line">    function FindOwnerId(string memory workId) public view returns (address)</span><br><span class="line">    &#123;</span><br><span class="line">        address owner &#x3D; _owners[workId];</span><br><span class="line">        return owner;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * @dev 获取作品的URI</span><br><span class="line">     *&#x2F;</span><br><span class="line">    function FindUri(string memory workId) public view returns (string memory)</span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">        string memory _workURI &#x3D; _works[workId].workUri;</span><br><span class="line"></span><br><span class="line">        return _workURI;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * @dev 获取作品的著作权人名字</span><br><span class="line">     *&#x2F;</span><br><span class="line">    function FindWorkOwnername(string memory workId) public view returns (string memory)</span><br><span class="line">    &#123;</span><br><span class="line">        string memory _workOwnername &#x3D; _works[workId].workOwnername;</span><br><span class="line"></span><br><span class="line">        return _workOwnername;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * @dev 获取作品的著作权人证件号码</span><br><span class="line">     *&#x2F;</span><br><span class="line">    function FindWorkOwnerid(string memory workId) public view returns (string memory)</span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">        string memory _workOwnerid &#x3D; _works[workId].workOwnerid;</span><br><span class="line"></span><br><span class="line">        return _workOwnerid;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * @dev 添加作品</span><br><span class="line">     *&#x2F;</span><br><span class="line">    function addWorks(address to, string memory ownerWebId, string memory workId, string memory uri ,string memory ownername ,string memory ownerid) public returns(bool)</span><br><span class="line">    &#123;</span><br><span class="line">        _addWorks(to, ownerWebId, workId, uri, ownername, ownerid);</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * @dev 添加作品，上链</span><br><span class="line">     *&#x2F;</span><br><span class="line">    function _addWorks(address to, string memory _ownerWebId,  string  memory workId, string memory _workURI, string memory ownername, string memory ownerid) public </span><br><span class="line">    &#123;</span><br><span class="line">        _owners[workId] &#x3D; to;</span><br><span class="line">        _works[workId].ownerWebId&#x3D;_ownerWebId;</span><br><span class="line">        _works[workId].workUri&#x3D; _workURI;</span><br><span class="line">        _works[workId].workOwnername&#x3D;ownername;</span><br><span class="line">        _works[workId].workOwnerid&#x3D;ownerid;</span><br><span class="line">        emit Transfer(address(0), to, workId);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>部署合约需要编译后的abi和Bytecode，在remix编译器中在CONTRACT栏中选择智能合约编译，编译完成后可以点击下方ABI和Bytecode按钮复制</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="\web3Blog\image-20230627095049968.png" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<p>打开geth控制台，进行合约部署</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">var abi&#x3D;&#x2F;*复制的abi粘贴到此处*&#x2F;</span><br><span class="line">var bytecode&#x3D;&#x2F;*复制的bytecode粘贴到此处,开头加上0x*&#x2F;</span><br><span class="line">var Contract&#x3D;eth.contract(abi) &#x2F;&#x2F;通过abi创建合约对象</span><br><span class="line">&#x2F;*部署合约之前要先解锁账户*&#x2F;</span><br><span class="line">personal.unlockAccount(eth.accounts[0])</span><br><span class="line">contractInstance &#x3D; Contract.new(&quot;copyright&quot;,&quot;cpr&quot;,&#123;data:bytecode ,gas: 4700000, from: eth.accounts[0]&#125;) &#x2F;&#x2F;发送部署合约的交易，燃气费gas可以设大一点，用不完会返还</span><br></pre></td></tr></table></figure>

<p>其中合约对象的new方法参数为（[para1],[para2],{[tansactionSetting]}）</p>
<p>前面为合约构造方法的参数（若构造方法无参数可以忽略），最后一个{}内是交易的设置（包含bytecode、gas等等）</p>
<p>燃气费的设置：可以使用<code>eth.estimateGas({data:bytecode})</code>来估算燃气费</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="\web3Blog\image-20230627155252694.png" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<p>例如示例合约中的构造方法有2个字符串参数，因此在{}前设置了2个字符串的参数</p>
<p>日志中提交合约部署： Submitted contract creation              fullhash&#x3D;0xd77274b34452e177a203e05d0b5b50392134ce83dbf6e123c8e344e0f2f2154e contract&#x3D;0x254485cF390f8be507857c1C160b670E3715f847</p>
<!--contract项为合约地址，可以保存起来以后使用-->

<p>同样需要挖矿将合约写入区块链</p>
<h3 id="geth控制台调用智能合约"><a href="#geth控制台调用智能合约" class="headerlink" title="geth控制台调用智能合约"></a>geth控制台调用智能合约</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">contractObj&#x3D;eth.contract(abi) &#x2F;&#x2F;根据abi构建合约对象</span><br><span class="line">contract&#x3D;contractObj.at(address) &#x2F;&#x2F;填入合约地址</span><br></pre></td></tr></table></figure>

<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="\web3Blog\image-20230627151942379.png" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<p>此时可以使用contract调用方法</p>
<h4 id="查询方法"><a href="#查询方法" class="headerlink" title="查询方法"></a>查询方法</h4><p>示例合约中的getName为查询方法，不改变区块链的状态，不用挖矿就可以执行，使用call()调用</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">contract.[method].call([para1],[para2])</span><br></pre></td></tr></table></figure>

<p>示例</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">contract.getName.call() &#x2F;&#x2F;使用call调用</span><br></pre></td></tr></table></figure>

<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="\web3Blog\image-20230627152222302.png" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<h4 id="发送交易"><a href="#发送交易" class="headerlink" title="发送交易"></a>发送交易</h4><p>改变区块链中状态的方法需要发送交易，需要挖矿才能执行，使用sendTransaction()调用，控制台中会返回交易哈希</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">contract.[method].sendTransaction([para1],[para2],&#123;[tansactionSetting]&#125;)</span><br></pre></td></tr></table></figure>

<p>示例</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">contract2.addWorks.sendTransaction(eth.accounts[0],&#39;5&#39;,&#39;001&#39;,&#39;120.48.51.66&#39;,&#39;dl&#39;,&#39;46000***&#39;,&#123;from:eth.accounts[0]&#125;)</span><br></pre></td></tr></table></figure>

<p>日志中会提示  Submitted transaction                    fullhash&#x3D;0x5b94548b402dd7813ec2218cef9170fb05f9d2d074bc6824ab4a859ee32734c7 recipient&#x3D;0x254485cF390f8be507857c1C160b670E3715f847</p>
<!--fullhash为交易哈希-->

<p>需要挖矿将交易处理</p>
<p>运行结果：使用合约中查询的方法进行验证</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">contract2.FindWorkOwnername.call(&quot;001&quot;)</span><br></pre></td></tr></table></figure>

<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="web3Blog\image-20230627161203131.png" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<p>可以看到数据已经写入区块链中</p>
<h1 id="使用web3js调用智能合约"><a href="#使用web3js调用智能合约" class="headerlink" title="使用web3js调用智能合约"></a>使用web3js调用智能合约</h1><h2 id="web3js安装"><a href="#web3js安装" class="headerlink" title="web3js安装"></a>web3js安装</h2><p>v0.20</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install web3@^0.20.0</span><br></pre></td></tr></table></figure>



<p>v1.2.6</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install web3@^1.2.6</span><br></pre></td></tr></table></figure>



<h2 id="链接到区块链"><a href="#链接到区块链" class="headerlink" title="链接到区块链"></a>链接到区块链</h2><p>v0.20</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Web3=<span class="built_in">require</span>(<span class="string">"web3"</span>)</span><br><span class="line"><span class="keyword">var</span> web3 = <span class="keyword">new</span> Web3()</span><br><span class="line">web3.setProvider(<span class="keyword">new</span> Web3.providers.HttpProvider(<span class="string">'[url]:8545'</span>));<span class="comment">//url处填入地址</span></span><br></pre></td></tr></table></figure>



<p>v1.2.6</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Web3=<span class="built_in">require</span>(<span class="string">"web3"</span>)</span><br><span class="line"><span class="keyword">var</span> web3 = <span class="keyword">new</span> Web3(Web3.givenProvider || <span class="string">'[url]:8545'</span>);</span><br></pre></td></tr></table></figure>



<h2 id="部署合约"><a href="#部署合约" class="headerlink" title="部署合约"></a>部署合约</h2><p>部署合约之前需要先使用<code>web3.personal.unlockAccount([account],[password])</code>解锁账户,希望使用js解锁账户需要在启动节点时加上参数<code>--allow-insecure-unlock</code> </p>
<p>v0.20</p>
<p>与在geth上部署相同，先使用<code>web3.eth.contract(abi)</code>创建合约示例，再使用合约示例的<code>new([constructorPara1],[constructorPara1],{[setting]},[callback])</code>方法部署合约</p>
<p><code>[callback]</code>为回调函数，为可选项</p>
<p>异步部署</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//解锁账户</span></span><br><span class="line">web3.personal.unlockAccount(myAccount,password)</span><br><span class="line"><span class="comment">//创建合约实例</span></span><br><span class="line"><span class="keyword">var</span> myContract=web3.eth.contract(abi);</span><br><span class="line"><span class="comment">//部署合约</span></span><br><span class="line"><span class="keyword">var</span> myContractInstance=myContract.new(<span class="string">"copyright"</span>,<span class="string">"cpr"</span>,&#123;</span><br><span class="line">        <span class="keyword">from</span>:myAccount, <span class="comment">//解锁的账户地址</span></span><br><span class="line">        data:bytecode, <span class="comment">//合约的bytecode</span></span><br><span class="line">        gas:<span class="number">4700000</span>, <span class="comment">//燃气费</span></span><br><span class="line">    &#125;,<span class="function"><span class="keyword">function</span> (<span class="params">err,result</span>) </span>&#123; </span><br><span class="line">    <span class="comment">//会回调2次，第1次是在发起交易时生成交易哈希时回调，第2次是合约部署完成时回调，此时有合约的地址</span></span><br><span class="line">    <span class="keyword">if</span>(!err) &#123;</span><br><span class="line">       <span class="keyword">if</span>(!myContractInstance.address) &#123;</span><br><span class="line">           <span class="built_in">console</span>.log(myContractInstance.transactionHash) </span><br><span class="line">       &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">           <span class="built_in">console</span>.log(myContractInstance.address) </span><br><span class="line">       &#125;</span><br><span class="line">     &#125;</span><br><span class="line">   &#125;)</span><br></pre></td></tr></table></figure>



<p>同步部署，合约部署的地址可以通过查询发送部署时返回的交易哈希的to项找到，或者在日志中的Submitted contract creation记录中的contract项中找到</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//解锁账户</span></span><br><span class="line">web3.personal.unlockAccount(myAccount,password)</span><br><span class="line"><span class="comment">//创建合约实例</span></span><br><span class="line"><span class="keyword">var</span> myContract=web3.eth.contract(abi);</span><br><span class="line"><span class="comment">//部署合约，不加上callback即可</span></span><br><span class="line"><span class="keyword">var</span> myContractInstance=myContract.new(<span class="string">"copyright"</span>,<span class="string">"cpr"</span>,&#123;</span><br><span class="line">        <span class="keyword">from</span>:myAccount, <span class="comment">//解锁的账户地址</span></span><br><span class="line">        data:bytecode, <span class="comment">//合约的bytecode</span></span><br><span class="line">        gas:<span class="number">4700000</span>, <span class="comment">//燃气费</span></span><br><span class="line">    &#125;)</span><br></pre></td></tr></table></figure>



<p>v1.6.2</p>
<p>在remix编译器中的编译界面的编译详情中的web3deploy可以找到部署合约代码的模板</p>
<p>使用的方法：</p>
<p>构建合约对象：<code>var simpcopyrightContract = new web3.eth.Contract(abi);</code>参数为abi，与0.20不同之处在于Contract首字母大写</p>
<p>部署合约：<code>var simpcopyright = simpcopyrightContract.deploy( {data: bytecode,arguments:[para1,para2]}).send({from:account,gas:gasNum},callback)</code></p>
<p>参数：</p>
<p><code>data</code>：bytecode</p>
<p><code>argurements:[]</code>：合约构造方法传参</p>
<p>示例：remix默认使用了第一个创建的账户进行部署</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="\web3Blog\image-20230628164137721.png" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="\web3Blog\image-20230628164212193.png" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> name_ = <span class="comment">/* var of type string here */</span> ;</span><br><span class="line"><span class="keyword">var</span> symbol_ = <span class="comment">/* var of type string here */</span> ;</span><br><span class="line"><span class="keyword">var</span> simpcopyrightContract = <span class="keyword">new</span> web3.eth.Contract([abi]);</span><br><span class="line"><span class="keyword">var</span> simpcopyright = simpcopyrightContract.deploy(&#123;</span><br><span class="line">     data: [bytecode], </span><br><span class="line">     <span class="built_in">arguments</span>: [</span><br><span class="line">          name_,</span><br><span class="line">          symbol_,</span><br><span class="line">     ]</span><br><span class="line">&#125;).send(&#123;</span><br><span class="line">     <span class="keyword">from</span>: web3.eth.accounts[<span class="number">0</span>], </span><br><span class="line">     gas: <span class="string">'4700000'</span></span><br><span class="line">   &#125;, <span class="function"><span class="keyword">function</span> (<span class="params">e, contract</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(e, contract);</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> contract.address !== <span class="string">'undefined'</span>) &#123;</span><br><span class="line">         <span class="built_in">console</span>.log(<span class="string">'Contract mined! address: '</span> + contract.address + <span class="string">' transactionHash: '</span> + contract.transactionHash);</span><br><span class="line">    &#125;</span><br><span class="line"> &#125;)</span><br></pre></td></tr></table></figure>



<h2 id="调用合约"><a href="#调用合约" class="headerlink" title="调用合约"></a>调用合约</h2><h3 id="创建合约实体"><a href="#创建合约实体" class="headerlink" title="创建合约实体"></a>创建合约实体</h3><p>调用合约之前需要构造合约实体以调用方法</p>
<p>v0.20</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> myContract=web3.eth.contract(abi) <span class="comment">//使用abi构建合约对象</span></span><br><span class="line"><span class="keyword">var</span> myContractInstance=myContract.at(myContractAddress)</span><br></pre></td></tr></table></figure>

<p>参数<code>myContractAddress</code>为部署好的合约地址</p>
<p>此时可以使用<code>myContractInstance</code>调用合约方法</p>
<h3 id="查询方法-1"><a href="#查询方法-1" class="headerlink" title="查询方法"></a>查询方法</h3><p>与geth上调用智能合约使用同样的样例</p>
<p>v0.20</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">myContractInstance.constantMethod.call(para1,para2)</span><br></pre></td></tr></table></figure>

<p><code>constantMethod</code>为合约的方法名，</p>
<p><code>para1</code>、<code>para2</code>为该方法的参数，没有参数不用写</p>
<p>示例</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//将结果打印在控制台上</span></span><br><span class="line"><span class="built_in">console</span>.log(simpCopyrightInstance.getName.call()); <span class="comment">//无参数</span></span><br><span class="line"><span class="built_in">console</span>.log(simpCopyrightInstance.FindWorkOwnername.call(<span class="string">'001'</span>)); <span class="comment">//有一个参数的方法</span></span><br></pre></td></tr></table></figure>



<h3 id="发送交易-1"><a href="#发送交易-1" class="headerlink" title="发送交易"></a>发送交易</h3><p>会改变区块链状态的方法需要通过发送交易的方式来调用</p>
<p>v0.20</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">myContractInstance.changingStateMethod(para1,para2,callback)</span><br></pre></td></tr></table></figure>

<p><code>changingStateMethod</code>为改变区块链状态的方法名</p>
<p><code>para1,para2</code>为方法参数，没有参数不用写</p>
<p><code>callback</code>为回调函数，可选项，支持异步执行</p>
<p>示例</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">simpCopyrightInstance.addWorks(myAccount,<span class="string">'5'</span>,<span class="string">'002'</span>,<span class="string">'202.197.99.35/work002'</span>,<span class="string">'dl2'</span>,<span class="string">'46000***'</span>,</span><br><span class="line">    <span class="function"><span class="keyword">function</span>(<span class="params">err, result</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!err)&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(result)<span class="comment">//把返回的交易哈希打印在控制台上</span></span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(err)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>用查询函数进行验证</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(simpCopyrightInstance.FindWorkOwnername.call(<span class="string">"002"</span>)); <span class="comment">//打印出'dl2'</span></span><br></pre></td></tr></table></figure>


        </div>

        <blockquote class="post-copyright">
    
    <div class="content">
        
<span class="post-time">
    最后更新时间：<time datetime="2023-06-30T03:11:18.432Z" itemprop="dateUpdated">2023-06-30 11:11:18</time>
</span><br>


        
        这里可以写作者留言，标签和 hexo 中所有变量及辅助函数等均可调用，示例：<a href="/2023/06/29/blog001/" target="_blank" rel="external">https://thunderfiresword.github.io/project/2023/06/29/blog001/</a>
        
    </div>
    
    <footer>
        <a href="https://thunderfiresword.github.io/project">
            <img src="/img/BlogAvatar.jpg" alt="ThunderFireSword">
            ThunderFireSword
        </a>
    </footer>
</blockquote>

        


        <div class="post-footer">
            

            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://thunderfiresword.github.io/project/2023/06/29/blog001/&title=《以太坊区块链私链搭建和使用web3.js与节点进行交互》 — ThunderFireSwordBlog&pic=https://thunderfiresword.github.io/project/img/BlogAvatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://thunderfiresword.github.io/project/2023/06/29/blog001/&title=《以太坊区块链私链搭建和使用web3.js与节点进行交互》 — ThunderFireSwordBlog&source=" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://thunderfiresword.github.io/project/2023/06/29/blog001/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《以太坊区块链私链搭建和使用web3.js与节点进行交互》 — ThunderFireSwordBlog&url=https://thunderfiresword.github.io/project/2023/06/29/blog001/&via=https://thunderfiresword.github.io/project" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://thunderfiresword.github.io/project/2023/06/29/blog001/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>

    


    


<section class="comments" id="comments">
    <div id="disqus_thread"></div>
    <script>
    var disqus_shortname = 'true';
    lazyScripts.push('//' + disqus_shortname + '.disqus.com/embed.js')
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" target="_blank" rel="noopener">comments powered by Disqus.</a></noscript>
</section>



















</article>



</div>

        <footer class="footer">
    <div class="top">
        
<p>
    <span id="busuanzi_container_site_uv" style='display:none'>
        站点总访客数：<span id="busuanzi_value_site_uv"></span>
    </span>
    <span id="busuanzi_container_site_pv" style='display:none'>
        站点总访问量：<span id="busuanzi_value_site_pv"></span>
    </span>
</p>


        <p>
            
                <span><a href="/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-lg icon-rss"></i></a></span>
            
            <span>博客内容遵循 <a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank">知识共享 署名 - 非商业性 - 相同方式共享 4.0 国际协议</a></span>
        </p>
    </div>
    <div class="bottom">
        <p><span>ThunderFireSword &copy; 2023</span>
            <span>
                
                Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank">indigo</a>
            </span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://thunderfiresword.github.io/project/2023/06/29/blog001/&title=《以太坊区块链私链搭建和使用web3.js与节点进行交互》 — ThunderFireSwordBlog&pic=https://thunderfiresword.github.io/project/img/BlogAvatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://thunderfiresword.github.io/project/2023/06/29/blog001/&title=《以太坊区块链私链搭建和使用web3.js与节点进行交互》 — ThunderFireSwordBlog&source=" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://thunderfiresword.github.io/project/2023/06/29/blog001/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《以太坊区块链私链搭建和使用web3.js与节点进行交互》 — ThunderFireSwordBlog&url=https://thunderfiresword.github.io/project/2023/06/29/blog001/&via=https://thunderfiresword.github.io/project" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://thunderfiresword.github.io/project/2023/06/29/blog001/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMYAAADGCAAAAACs8KCBAAACK0lEQVR42u3aQW7DMAwEwP7/0+m1h9rZpdIClsanAnFcjQMsSIlfX/H1+nEln17defXd5L984MLAwHgs43V7Xd1z/4Scd39PsjYMDIxzGEkU5tGZ4O8Xmq8NAwMDo31csug26DEwMDDWA7co4OKnYWBgYMya2FlpmLfB/9SLY2BgPJAx277/n7//5HwDAwPjUYxXebUhOIvvelUYGBhbM9qyrx2MyI8zZ2UoBgbGOYx2iz8fj8i32NrvXj4NAwNja0Ybgp8K3JUgjn4TDAyMhzNmo6VtSdcutG13MTAw9mYkm1zthn6LWX8pGBgYJzDyrf92GGLW0A4jGAMDY1NGPmKVhGnbPc/AvzwfAwNja8bKzNXsCCF/BStlKAYGxn6M2YBXXgjOjiHzITMMDIy9GUlBlg+EJU1vG7jRK8DAwDiAkW+xrY9/zTb16mELDAyM7RhtUbhyqDkbyHgTwRgYGFszoh53dAwwa4OT4C6mRTAwMDZitLC29W2PIWclKQYGxt6MtoGcBfR6y/rmFWBgYBzAyJebNKJtO/oBJAYGxgGM2YbarDZrqUu9OAYGxsMZs2GvNnCTqF15rRgYGHsz8ut+cfmnCXV2OIqBgbE3ow3Z5E3MttLy4K4LRAwMjC0Y60MVK4eRbRN7GbgYGBgY5XFCXmgmIx1vqBgYGBhBdM6CMmluo+EwDAyMAxhJE5sXc7M4brfkMDAwzmG0Iw4teyWmZ2MfGBgYGzG+AR5fS6lRGqIxAAAAAElFTkSuQmCC" alt="微信分享二维码">
</div>




    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: false };


</script>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/main.min.js"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/search.min.js" async></script>






<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>



<script>
(function() {
    var OriginTitile = document.title, titleTime;
    document.addEventListener('visibilitychange', function() {
        if (document.hidden) {
            document.title = 'ThunerFireSwordBlog';
            clearTimeout(titleTime);
        } else {
            document.title = 'ThunerFireSwordBlog';
            titleTime = setTimeout(function() {
                document.title = OriginTitile;
            },2000);
        }
    });
})();
</script>



</body>
</html>
